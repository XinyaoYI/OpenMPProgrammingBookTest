
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. OpenMP Directive Syntax &#8212; OpenMP Application Programming Interface Examples</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="3. Parallel Execution" href="Chap_parallel_execution.html" />
    <link rel="prev" title="1. Introduction" href="Chap_introduction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to OMP Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Title_Page.html">
   Cover
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Foreword_Chapt.html">
   Foreword
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_introduction.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. OpenMP Directive Syntax
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_parallel_execution.html">
   3. Parallel Execution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_affinity.html">
   4. OpenMP Affinity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_tasking.html">
   5. Tasking
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_devices.html">
   6. Devices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_SIMD.html">
   7. SIMD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_loop_transformations.html">
   8. Loop Transformations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_synchronization.html">
   9. Synchronization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_data_environment.html">
   10. Data Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_memory_model.html">
   11. Memory Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chap_program_control.html">
   12. Program Control
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Chap_directives.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/passlab/Examples"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Chap_directives.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/contents/Chap_directives.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c-c-pragmas">
   2.1. C/C++ Pragmas
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c-attributes">
   2.2. C++ Attributes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fortran-comments-fixed-source-form">
   2.3. Fortran Comments (Fixed Source Form)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fortran-comments-free-source-form">
   2.4. Fortran Comments (Free Source Form)
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>OpenMP Directive Syntax</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c-c-pragmas">
   2.1. C/C++ Pragmas
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c-attributes">
   2.2. C++ Attributes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fortran-comments-fixed-source-form">
   2.3. Fortran Comments (Fixed Source Form)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fortran-comments-free-source-form">
   2.4. Fortran Comments (Free Source Form)
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="openmp-directive-syntax">
<h1><span class="section-number">2. </span>OpenMP Directive Syntax<a class="headerlink" href="#openmp-directive-syntax" title="Permalink to this headline">#</a></h1>
<p>OpenMP <em>directives</em> use base-language mechanisms to specify OpenMP program behavior. In C code, the directives are formed exclusively with pragmas, whereas in C++ code, directives are formed from either pragmas or attributes. Fortran directives are formed with comments in free form and fixed form sources (codes). All of these mechanisms allow the compilation to ignore the OpenMP directives if OpenMP is not supported or enabled.</p>
<p>The OpenMP directive is a combination of the base-language mechanism and a  <em>directive-specification</em> , as shown below. The  <em>directive-specification</em>  consists of the  <em>directive-name</em>  which may seldomly have arguments,  followed by optional  <em>clauses</em> . Full details of the syntax can be found in the OpenMP Specification. Illustrations of the syntax is given in the examples.</p>
<p>The formats for combining a base-language mechanism and a  <em>directive-specification</em>  are:</p>
<p>C/C++ pragmas</p>
<p>    
<strong>#pragma omp</strong>
<em>directive-specification</em></p>
<p>C++ attributes<br />
    
<strong>[[omp :: directive(</strong>
<em>directive-specification</em>
<strong>)]]</strong></p>
<p>    
<strong>[[using omp : directive(</strong>
<em>directive-specification</em>
<strong>)]]</strong></p>
<p>Fortran comments<br />
    <strong>!$omp</strong>  <em>directive-specification</em></p>
<p>where <strong>c\$omp</strong> and <strong>*$omp</strong> may be used in Fortran fixed form sources.</p>
<p>Most OpenMP directives accept clauses that alter the semantics of the directive in some way,  and some directives also accept parenthesized arguments that follow the directive name.  A clause may just be a keyword (e.g., <strong>untied</strong>) or it may also accept argument lists  (e.g., <strong>shared(x,y,z)</strong>) and/or optional modifiers (e.g., <strong>tofrom</strong> in  <strong>map(tofrom: x,y,z)</strong>). Clause modifiers may be “simple” or “complex” – a complex modifier consists of a  keyword followed by one or more parameters, bracketed by parentheses, while a simple  modifier does not. An example of a complex modifier is the <strong>iterator</strong> modifier,  as in <strong>map(iterator(i=0:n),tofrom: p[i])</strong>, or the <strong>step</strong> modifier, as in <strong>linear(x:</strong> <strong>ref,</strong> <strong>step(4))</strong>.  In the preceding examples, <strong>tofrom</strong> and <strong>ref</strong> are simple modifiers.</p>
<section id="c-c-pragmas">
<h2><span class="section-number">2.1. </span>C/C++ Pragmas<a class="headerlink" href="#c-c-pragmas" title="Permalink to this headline">#</a></h2>
<p>OpenMP C and C++ directives can be specified with the C/C++ <strong>#pragma</strong> directive. An OpenMP directive begins with <strong>#pragma omp</strong> and is followed by the  OpenMP directive name, and required and optional clauses. Lines are continued in the  usual manner, and comments may be included at the end. Directives are case sensitive.</p>
<p>The example below illustrates the use of the OpenMP pragma form. The first pragma (PRAG 1) specifies a combined <strong>parallel for</strong> directive, with a <strong>num_threads</strong> clause, and a comment.  The second pragma (PRAG 2) shows the same directive split across two lines. The next nested pragmas (PRAG 3 and 4) show the previous combined directive as  two separate directives. The executable directives above all apply to the next  statement. The <strong>parallel</strong> directive can be applied to a  <em>structured</em>   <em>block</em>  as shown in PRAG 5.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name:       directive_syntax_pragma.1</span>
<span class="cm">* type:       C</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w">   </span><span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#define NT 4</span>
<span class="cp">#define thrd_no omp_get_thread_num</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp parallel for num_threads(NT)                 </span><span class="c1">// PRAG 1</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp parallel for \</span>
<span class="cp">                num_threads(NT)                              </span><span class="c1">// PRAG 2</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp parallel num_threads(NT)                     </span><span class="c1">// PRAG 3-4</span>
<span class="w">    </span><span class="cp">#pragma omp for</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp parallel num_threads(NT)                     </span><span class="c1">// PRAG 5</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thrd_no</span><span class="p">();</span><span class="w"></span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d is Odd </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">no</span><span class="p">);}</span><span class="w"></span>
<span class="w">       </span><span class="k">else</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d is Even</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">no</span><span class="p">);}</span><span class="w"></span>

<span class="w">       </span><span class="cp">#pragma omp for</span>
<span class="w">       </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="cm">/*</span>
<span class="cm">      repeated 4 times, any order</span>
<span class="cm">      OUTPUT: thrd no 0</span>
<span class="cm">      OUTPUT: thrd no 1</span>
<span class="cm">      OUTPUT: thrd no 2</span>
<span class="cm">      OUTPUT: thrd no 3</span>

<span class="cm">      any order</span>
<span class="cm">      OUTPUT: thrd no 0 is Even</span>
<span class="cm">      OUTPUT: thrd no 2 is Even</span>
<span class="cm">      OUTPUT: thrd no 1 is Odd</span>
<span class="cm">      OUTPUT: thrd no 3 is Odd</span>
<span class="cm">*/</span><span class="w"></span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="c-attributes">
<h2><span class="section-number">2.2. </span>C++ Attributes<a class="headerlink" href="#c-attributes" title="Permalink to this headline">#</a></h2>
<p><strong>directive syntax!attribute, C++</strong> <strong>attribute syntax, C++</strong></p>
<p>OpenMP directives for C++ can also be specified with  the <strong>directive</strong> extension for the C++11 standard  <em>attributes</em> .</p>
<p>The C++ example below shows two ways to parallelize a <strong>for</strong> loop using the <strong>#pragma</strong> syntax. The first pragma uses the combined <strong>parallel</strong> <strong>for</strong> directive, and the second applies the uncombined closely nested directives, <strong>parallel</strong> and <strong>for</strong>, directly to the same statement.  These are labeled PRAG 1-3.</p>
<p>Using the attribute syntax, the same construct in PRAG 1 is applied two different ways in attribute form, as shown in the ATTR 1 and ATTR 2 sections. In ATTR 1 the attribute syntax is used with the <strong>omp ::</strong> namespace form. In ATTR 2 the attribute syntax is used with the <strong>using omp :</strong> namespace form.</p>
<p>Next, parallelization is attempted by applying directives using two different syntaxes. For ATTR 3 and PRAG 4, the loop parallelization will fail to compile because multiple directives that apply to the same statement must all use either the attribute syntax or the pragma syntax. The lines have been commented out and labeled INVALID.</p>
<p>While multiple attributes may be applied to the same statement, compilation may fail if the ordering of the directive matters. For the ATTR 4-5 loop parallelization, the <strong>parallel</strong> directive precedes  the <strong>for</strong> directive, but the compiler may reorder consecutive attributes. If the directives are reversed, compilation will fail.</p>
<p>The attribute directive of the ATTR 6 section resolves the previous problem (in ATTR 4-5). Here, the <strong>sequence</strong> attribute is used to apply ordering to the directives of ATTR 4-5, using the <strong>omp</strong> <strong>::</strong> namespace qualifier. (The <strong>using omp :</strong> namespace form is not available for the <strong>sequence</strong> attribute.)  Note, for the <strong>sequence</strong> attribute a comma must separate the <strong>directive</strong> extensions.</p>
<p>The last 3 pairs of sections (PRAG DECL 1-2, 3-4, and 5-6) show cases where  directive ordering does not matter for <strong>declare</strong> <strong>simd</strong> directives.</p>
<p>In section PRAG DECL 1-2, the two loops use different SIMD forms of the  <em>P</em>  function (one with <strong>simdlen(4)</strong> and the other with <strong>simdlen(8)</strong>),  as prescribed by the two different <strong>declare</strong> <strong>simd</strong> directives applied to the  <em>P</em>  function definitions (at the beginning of the code).  The directives use the pragma syntax, and order is not important.  For the next set of loops  (PRAG DECL 3-4) that use the  <em>Q</em>  function, the attribute syntax is  used for the <strong>declare</strong> <strong>simd</strong> directives.  The result is compliant code since directive order is irrelevant. Sections ATTR DECL 5-6 are included for completeness. Here, the attribute  form of the <strong>simd</strong> directive is used for loops calling the  <em>Q</em>  function,  in combination with the attribute form of the <strong>declare</strong> <strong>simd</strong>  directives declaring the variants for  <em>Q</em> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name:       directive_syntax_attribute.1</span>
<span class="cm">* type:       C++</span>
<span class="cm">* version:    omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>
<span class="cp">#define NT 4</span>
<span class="cp">#define thrd_no omp_get_thread_num</span>

<span class="cp">#pragma omp declare simd linear(i) simdlen(4)</span>
<span class="cp">#pragma omp declare simd linear(i) simdlen(8)</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">P</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="p">[[</span><span class="n">omp</span><span class="o">::</span><span class="n">directive</span><span class="p">(</span><span class="n">declare</span><span class="w"> </span><span class="n">simd</span><span class="w"> </span><span class="n">linear</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">simdlen</span><span class="p">(</span><span class="mi">4</span><span class="p">))]]</span><span class="w"></span>
<span class="p">[[</span><span class="n">omp</span><span class="o">::</span><span class="n">directive</span><span class="p">(</span><span class="n">declare</span><span class="w"> </span><span class="n">simd</span><span class="w"> </span><span class="n">linear</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">simdlen</span><span class="p">(</span><span class="mi">8</span><span class="p">))]]</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp parallel for num_threads(NT)                 </span><span class="c1">// PRAG 1</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp parallel num_threads(NT)                     </span><span class="c1">// PRAG 2</span>
<span class="w">    </span><span class="cp">#pragma omp for                                          </span><span class="c1">// PRAG 3</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">                                                             </span><span class="c1">// ATTR 1</span>
<span class="w">    </span><span class="p">[[</span><span class="n">omp</span><span class="o">::</span><span class="n">directive</span><span class="p">(</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="n">NT</span><span class="p">))]]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">                                                             </span><span class="c1">// ATTR 2</span>
<span class="w">    </span><span class="p">[[</span><span class="n">using</span><span class="w"> </span><span class="n">omp</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">directive</span><span class="p">(</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="n">NT</span><span class="p">))]]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w"> </span><span class="c1">// INVALID-- attribute and non-attribute on same statement</span>
<span class="w"> </span><span class="c1">// [[ omp :: directive( parallel num_threads(NT) ) ]]          ATTR 3</span>
<span class="w"> </span><span class="c1">// #pragma omp for                                             PRAG 4</span>
<span class="w"> </span><span class="c1">// for(int i=0; i&lt;NT; i++) printf(&quot;thrd no %d\n&quot;,thrd_no());</span>


<span class="w"> </span><span class="c1">// INVALID-- directive order not guaranteed</span>
<span class="w"> </span><span class="c1">// [[ omp :: directive( parallel num_threads(NT) ) ]]          ATTR 4</span>
<span class="w"> </span><span class="c1">// [[ omp :: directive( for                      ) ]]          ATTR 5</span>
<span class="w"> </span><span class="c1">// for(int i=0; i&lt;NT; i++) printf(&quot;thrd no %d\n&quot;,thrd_no());</span>

<span class="w">                                                             </span><span class="c1">// ATTR 6</span>
<span class="w">    </span><span class="p">[[</span><span class="n">omp</span><span class="o">::</span><span class="n">sequence</span><span class="p">(</span><span class="n">directive</span><span class="p">(</span><span class="n">parallel</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="n">NT</span><span class="p">)),</span><span class="n">directive</span><span class="p">(</span><span class="k">for</span><span class="p">))]]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NT</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd no %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">thrd_no</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">tmp</span><span class="o">=</span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp simd reduction(+:tmp) simdlen(4)</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">                 </span><span class="c1">// PRAG DECL 1</span>
<span class="w">    </span><span class="cp">#pragma omp simd reduction(+:tmp) simdlen(8)</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">                 </span><span class="c1">// PRAG DECL 2</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tmp</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">tmp</span><span class="o">=</span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp simd reduction(+:tmp) simdlen(4)</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">                 </span><span class="c1">// ATTR DECL 3</span>
<span class="w">    </span><span class="cp">#pragma omp simd reduction(+:tmp) simdlen(8)</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">                 </span><span class="c1">// ATTR DECL 4</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tmp</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">tmp</span><span class="o">=</span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[[</span><span class="w"> </span><span class="n">omp</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">directive</span><span class="p">(</span><span class="n">simd</span><span class="w"> </span><span class="n">reduction</span><span class="p">(</span><span class="o">+:</span><span class="n">tmp</span><span class="p">)</span><span class="w"> </span><span class="n">simdlen</span><span class="p">(</span><span class="mi">4</span><span class="p">))]]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">                 </span><span class="c1">// ATTR DECL 5</span>
<span class="w">    </span><span class="p">[[</span><span class="w"> </span><span class="n">omp</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">directive</span><span class="p">(</span><span class="n">simd</span><span class="w"> </span><span class="n">reduction</span><span class="p">(</span><span class="o">+:</span><span class="n">tmp</span><span class="p">)</span><span class="w"> </span><span class="n">simdlen</span><span class="p">(</span><span class="mi">8</span><span class="p">))]]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">                 </span><span class="c1">// ATTR DECL 6</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tmp</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">//    repeated 5 times, any order:</span>
<span class="c1">//    OUTPUT: thrd no  0</span>
<span class="c1">//    OUTPUT: thrd no  1</span>
<span class="c1">//    OUTPUT: thrd no  2</span>
<span class="c1">//    OUTPUT: thrd no  3</span>

<span class="c1">//    repeated 3 time:</span>
<span class="c1">//    OUTPUT: 656700.000000</span>


</pre></div>
</div>
</div>
</div>
</section>
<section id="fortran-comments-fixed-source-form">
<h2><span class="section-number">2.3. </span>Fortran Comments (Fixed Source Form)<a class="headerlink" href="#fortran-comments-fixed-source-form" title="Permalink to this headline">#</a></h2>
<p>OpenMP directives in Fortran codes with fixed source form are specified as comments with one of the <strong>!\<span class="math notranslate nohighlight">\(omp__, __c\\\)</span>omp</strong>, and <strong>*\$omp</strong> sentinels, followed by a directive name, and required and optional clauses.  The sentinel must begin in column 1.</p>
<p>In the example below the first directive (DIR 1) specifies the <strong>parallel</strong> <strong>do</strong> combined directive, with a <strong>num_threads</strong> clause, and a comment. The second directive (DIR 2) shows the same directive split across two lines. The next nested directives (DIR 3 and 4) show the previous combined directive as two separate directives.  Here, an <strong>end</strong> directive (<strong>end</strong> <strong>parallel</strong>) must be specified to demarcate the range (region) of the <strong>parallel</strong> directive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>!!%compiler: gfortran
!!%cflags: -fopenmp

! name: directive_syntax_F_fixed_comment.1
! type: F-fixed
      program main
      include &#39;omp_lib.h&#39;
      integer NT

      NT =4

c     sentinel c\$omp or *\$omp can also be used

c$omp parallel do num_threads(NT) !comments allowed here   DIR 1
      do i = 1,NT
        write(*,&#39;(&quot;thrd no&quot;, i2)&#39;) omp_get_thread_num()
      end do

!$omp parallel do
!$omp+ num_threads(NT)          !cont. w. char in col. 6   DIR 2
      do i = 1,NT
        write(*,&#39;(&quot;thrd no&quot;, i2)&#39;) omp_get_thread_num()
      end do

*$omp parallel num_threads(NT)  !multi-directive form      DIR 3
*$omp do                        !                          DIR 4
      do i = 1,NT
         write(*,&#39;(&quot;thrd no&quot;, i2)&#39;) omp_get_thread_num()
      end do
*$omp end parallel
      end
!     repeated 3 times, any order
!     OUTPUT: thrd no  0
!     OUTPUT: thrd no  1
!     OUTPUT: thrd no  2
!     OUTPUT: thrd no  3

</pre></div>
</div>
</div>
</div>
</section>
<section id="fortran-comments-free-source-form">
<h2><span class="section-number">2.4. </span>Fortran Comments (Free Source Form)<a class="headerlink" href="#fortran-comments-free-source-form" title="Permalink to this headline">#</a></h2>
<p>OpenMP directives in Fortran codes with free source form are specified as comments that use the <code class="docutils literal notranslate"><span class="pre">!$omp</span></code> sentinel, followed by the directive name, and required and optional clauses.  Lines are continued with an ending ampersand (<strong>&amp;</strong>), and the continued line begins with <code class="docutils literal notranslate"><span class="pre">!$omp</span></code> or <code class="docutils literal notranslate"><span class="pre">!$omp&amp;</span></code>. Comments may appear on the same line as the directive.  Directives are case insensitive.</p>
<p>In the example below the first directive (DIR 1) specifies the <strong>parallel</strong> <strong>do</strong> combined directive, with a <strong>num_threads</strong> clause, and a comment. The second directive (DIR 2) shows the same directive split across two lines.  The next nested directives (DIR 3 and 4) show the previous combined directive as two separate directives.  Here, an <strong>end</strong> directive (<strong>end</strong> <strong>parallel</strong>) must be specified to demarcate the range (region) of the <strong>parallel</strong> directive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>!!%compiler: gfortran
!!%cflags: -fopenmp

! name:       directive_syntax_F_free_comment.1
! type:       F-free
  program main
     use omp_lib
     integer,parameter :: NT = 4

     !$omp parallel do num_threads(NT)                !DIR 1
     do i = 1,NT
       write(*,&#39;(&quot;thrd no&quot;, i2)&#39;) omp_get_thread_num()
     end do

     !$omp  parallel do  &amp;     !continue line         !DIR 2
     !$omp num_threads(NT)     !or !$omp&amp;
     do i = 1,NT
       write(*,&#39;(&quot;thrd no&quot;, i2)&#39;) omp_get_thread_num()
     end do

     !$omp parallel num_threads(NT)                   !DIR 3
     !$omp do                                         !DIR 4
     do i = 1,NT
        write(*,&#39;(&quot;thrd no&quot;, i2)&#39;) omp_get_thread_num()
     end do
     !$omp end parallel

  end program

!     repeated 3 times, any order
!     OUTPUT: thrd no  0
!     OUTPUT: thrd no  1
!     OUTPUT: thrd no  2
!     OUTPUT: thrd no  3

</pre></div>
</div>
</div>
</div>
<p>As of OpenMP 5.1, <strong>block</strong> and <strong>end</strong> <strong>block</strong> statements can be used to designate  a structured block for an OpenMP region, and any paired OpenMP <strong>end</strong> directive becomes optional, as shown in the next example.  Note, the variables  <em>i</em>  and  <em>thrd_no</em>  are declared within the  block structure and are hence private. It was necessary to explicitly declare the  <em>i</em>  variable, due to the <strong>implicit none</strong> statement;  it could have also been declared outside the structured block.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>!!%compiler: gfortran
!!%cflags: -fopenmp

! name:       directive_syntax_F_block.1
! type:       F-free
! version:    omp_5.1
  program main

     use omp_lib
     implicit none
     integer,parameter :: NT = 2, chunks=3

    !$omp parallel num_threads(NT)
     block                          ! Fortran 2008 OMP 5.1
       integer :: thrd_no,i
       thrd_no= omp_get_thread_num()
        !$omp do schedule(static,chunks)
        do i = 1,NT*chunks
           write(*,&#39;(&quot;ndx=&quot;,i0.2,&quot; thrd_no=&quot;, i0.2)&#39;) i,thrd_no
        end do
     end block
  end program

! any order
! OUTPUT: ndx=01 thrd_no=00
! OUTPUT: ndx=02 thrd_no=00
! OUTPUT: ndx=03 thrd_no=00
! OUTPUT: ndx=04 thrd_no=01
! OUTPUT: ndx=05 thrd_no=01
! OUTPUT: ndx=06 thrd_no=01
</pre></div>
</div>
</div>
</div>
<p>A Fortran BLOCK construct may eliminate the need for a paired <strong>end</strong> directive for an OpenMP construct,  as illustrated in the following example.</p>
<p>The first <strong>parallel</strong> construct is specified with an OpenMP loosely structured block  (where the first executable construct is not a Fortran 2008 BLOCK construct).  A paired <strong>end</strong> directive must end the OpenMP construct. The second <strong>parallel</strong> construct is specified with an OpenMP strictly structured block  (consists only of a single Fortran BLOCK construct).  The paired <strong>end</strong> directive is optional in this case, and is not used here.</p>
<p>The next two <strong>parallel</strong> directives form an enclosing outer <strong>parallel</strong> construct  and a nested inner <strong>parallel</strong> construct. The first <strong>end</strong> <strong>parallel</strong> directive that subsequently appears terminates the inner <strong>parallel</strong> construct,  because a paired <strong>end</strong> directive immediately following a BLOCK construct that is  a strictly structured block of an OpenMP construct is treated as the terminating end directive  of that construct.  The next <strong>end</strong> <strong>parallel</strong> directive is required to terminate the outer <strong>parallel</strong> construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w">       </span><span class="n">directive_syntax_F_block</span><span class="mf">.2</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w">       </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_5</span><span class="mf">.1</span><span class="w"></span>
<span class="n">program</span><span class="w"> </span><span class="n">main</span><span class="w"></span>

<span class="w">   </span><span class="n">use</span><span class="w"> </span><span class="n">omp_lib</span><span class="w"></span>
<span class="w">   </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>

<span class="w">  </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="w">         </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Loosely  structured block  -- end required.&quot;</span><span class="w"></span>
<span class="w">     </span><span class="n">block</span><span class="w">                                </span><span class="o">!</span><span class="w"> </span><span class="n">BLOCK</span><span class="w"> </span><span class="n">Fortran</span><span class="w"> </span><span class="mi">2008</span><span class="w"></span>
<span class="w">       </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="w">           </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;                           --&quot;</span><span class="w"></span>
<span class="w">     </span><span class="n">end</span><span class="w"> </span><span class="n">block</span><span class="w"></span>
<span class="w">  </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>

<span class="w">  </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="n">block</span><span class="w"></span>
<span class="w">       </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="w">           </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Strictly structured block  -- end not required.&quot;</span><span class="w"></span>
<span class="w">     </span><span class="n">end</span><span class="w"> </span><span class="n">block</span><span class="w"></span>
<span class="w"> </span><span class="o">!!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="o">!</span><span class="n">is</span><span class="w"> </span><span class="n">optional</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">strictly</span><span class="w"> </span><span class="n">structured</span><span class="w"> </span><span class="n">block</span><span class="w"></span>

<span class="w">  </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sequential part&quot;</span><span class="w"></span>

<span class="w">  </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">                      </span><span class="o">!</span><span class="n">outer</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="w">         </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Outer, loosely  structured block.&quot;</span><span class="w"></span>
<span class="w">     </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">                   </span><span class="o">!</span><span class="n">inner</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">        </span><span class="n">block</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="w">          </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Inner, strictly structured block.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="n">end</span><span class="w"> </span><span class="n">block</span><span class="w"></span>
<span class="w">     </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">  </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">  </span><span class="o">!</span><span class="w"> </span><span class="n">Two</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">directives</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">here</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="o">!</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="s">&quot;!$omp end parallel&quot;</span><span class="w"> </span><span class="n">terminator</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">fail</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="o">!</span><span class="w"> </span><span class="mi">1</span><span class="n">st</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">assumed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">construct</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="o">!</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">directive</span><span class="w"> </span><span class="n">applies</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">outer</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">construct</span><span class="p">.</span><span class="w"></span>

<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>

<span class="o">!</span><span class="n">OUTPUT</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">order</span><span class="o">:</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Loosely</span><span class="w">  </span><span class="n">structured</span><span class="w"> </span><span class="n">block</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">required</span><span class="p">.</span><span class="w"></span>
<span class="o">!</span><span class="w">                            </span><span class="o">--</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Strictly</span><span class="w"> </span><span class="n">structured</span><span class="w"> </span><span class="n">block</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">required</span><span class="p">.</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Sequential</span><span class="w"> </span><span class="n">part</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Outer</span><span class="p">,</span><span class="w"> </span><span class="n">loosely</span><span class="w">  </span><span class="n">structured</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Inner</span><span class="p">,</span><span class="w"> </span><span class="n">strictly</span><span class="w"> </span><span class="n">structured</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Inner</span><span class="p">,</span><span class="w"> </span><span class="n">strictly</span><span class="w"> </span><span class="n">structured</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="w"></span>

</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Chap_introduction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1. </span>Introduction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Chap_parallel_execution.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Parallel Execution</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The OpenMP Community<br/>
  
      &copy; <a href="../copyright.html">Copyright</a> 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>